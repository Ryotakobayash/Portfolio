---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

// タグと記事数を集計
const tagMap = new Map<string, number>();
posts.forEach((post) => {
  (post.data.tags || []).forEach((tag: string) => {
    tagMap.set(tag, (tagMap.get(tag) || 0) + 1);
  });
});

const tags = Array.from(tagMap.entries())
  .map(([tag, count]) => ({ tag, count }))
  .sort((a, b) => b.count - a.count);
---

<BaseLayout title="タグ一覧 | Dashboard Portfolio">
  <div class="page-header">
    <h1 class="page-title">タグ一覧</h1>
    <p class="page-description">{tags.length} 件のタグ</p>
  </div>

  <div class="tag-grid">
    {tags.map(({ tag, count }) => (
      <a href={`/tags/${tag.replace(/\//g, '-')}`} class="tag-card">
        <span class="tag-card__name">{tag}</span>
        <span class="tag-card__count">{count} 記事</span>
      </a>
    ))}
  </div>
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--spacing-xl);
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--spacing-sm);
  }

  .page-description {
    color: var(--color-text-muted);
  }

  .tag-grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
  }

  .tag-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: inherit;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  }

  .tag-card:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-sm);
  }

  .tag-card__name {
    font-weight: 500;
  }

  .tag-card__count {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }
</style>
