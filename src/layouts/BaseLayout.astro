---
import { ClientRouter } from 'astro:transitions';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = 'Dashboard Portfolio',
  description = '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂûã„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Çµ„Ç§„Éà',
} = Astro.props;

// Google Analytics 4 Measurement ID
const GA_MEASUREMENT_ID = 'G-3XG4W5WQD1';
const GTM_ID = 'GTM-WG6RHC88';
---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate" type="application/rss+xml" title="Dashboard Portfolio RSS" href="/rss.xml" />
    <ClientRouter />

    <!-- Dark mode script (run before render to prevent flash) -->
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>

    <!-- Google Analytics 4 -->
    <script is:inline define:vars={{ GA_MEASUREMENT_ID }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', GA_MEASUREMENT_ID);
    </script>
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}></script>

    <!-- Google Tag Manager -->
    <script is:inline define:vars={{ GTM_ID }}>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer',GTM_ID);
    </script>
  </head>
  <body>
    <!-- GTM noscript -->
    <noscript>
      <iframe
        src={`https://www.googletagmanager.com/ns.html?id=${GTM_ID}`}
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe>
    </noscript>

    <header class="header">
      <div class="container header-content">
        <a href="/" class="logo">üìä Dashboard Portfolio</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
          <span class="sun-icon">‚òÄÔ∏è</span>
          <span class="moon-icon">üåô</span>
        </button>
      </div>
    </header>

    <main class="main">
      <div class="container">
        <slot />
      </div>
    </main>

    <script>
      // Dark mode toggle
      const toggle = document.getElementById('theme-toggle');
      toggle?.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });
    </script>

    <!-- Vercel Speed Insights -->
    <script is:inline>
      window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script async defer src="/_vercel/speed-insights/script.js"></script>

    <!-- Vercel Analytics -->
    <script is:inline>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script async defer src="/_vercel/insights/script.js"></script>
  </body>
</html>
