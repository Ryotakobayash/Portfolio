---
export const prerender = true;
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import PostSearch from '../../components/PostSearch';

const posts = await getCollection('posts');
const sortedPosts = posts
  .map((post) => ({
    slug: post.id.replace(/\.mdx?$/, ''),
    title: post.data.title,
    date: post.data.date,
    excerpt: post.data.excerpt || '',
    tags: post.data.tags || [],
  }))
  .sort((a, b) => (a.date < b.date ? 1 : -1));

// 全タグリスト（出現回数順）
const tagCount = new Map<string, number>();
sortedPosts.forEach((post) => {
  post.tags.forEach((tag) => {
    tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
  });
});
const allTags = Array.from(tagCount.entries())
  .sort((a, b) => b[1] - a[1])
  .map(([tag]) => tag);
---

<BaseLayout title="記事一覧 | Dashboard Portfolio">
  <div class="page-header">
    <h1 class="page-title">記事一覧</h1>
    <p class="page-description">{sortedPosts.length} 件の記事</p>
  </div>

  <PostSearch client:load posts={sortedPosts} allTags={allTags} />
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--spacing-xl);
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--spacing-sm);
  }

  .page-description {
    color: var(--color-text-muted);
  }
</style>
