---
export const prerender = true;
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import PostSearch from '../../components/PostSearch';

const posts = await getCollection('posts');
const sortedPosts = posts
  .map((post) => ({
    slug: post.id.replace(/\.mdx?$/, ''),
    title: post.data.title,
    date: post.data.date,
    excerpt: post.data.excerpt || '',
    tags: post.data.tags || [],
  }))
  .sort((a, b) => (a.date < b.date ? 1 : -1));

// å…¨ã‚¿ã‚°ãƒªã‚¹ãƒˆï¼ˆå‡ºç¾å›æ•°é †ï¼‰
const tagCount = new Map<string, number>();
sortedPosts.forEach((post) => {
  post.tags.forEach((tag) => {
    tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
  });
});
const allTags = Array.from(tagCount.entries())
  .sort((a, b) => b[1] - a[1])
  .map(([tag]) => tag);
---

<BaseLayout title="è¨˜äº‹ä¸€è¦§ | Dashboard Portfolio">
  <div class="page-header">
    <h1 class="page-title">è¨˜äº‹ä¸€è¦§</h1>
    <div class="stats-row">
      <span class="stat-item">ğŸ“ {sortedPosts.length} Posts</span>
      <span class="stat-separator">Â·</span>
      <span class="stat-item">ğŸ·ï¸ {allTags.length} Tags</span>
      <span class="stat-separator">Â·</span>
      <span class="stat-item">ğŸ• æœ€æ–°: {sortedPosts[0]?.date}</span>
    </div>
  </div>

  <PostSearch client:load posts={sortedPosts} allTags={allTags} />
</BaseLayout>

<style>
  .page-header {
    margin-bottom: var(--spacing-xl);
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--spacing-sm);
  }

  .stats-row {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
  }

  .stat-item {
    font-size: 0.85rem;
    color: var(--color-text-muted);
  }

  .stat-separator {
    color: var(--color-border);
  }
</style>
